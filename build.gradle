import com.moowork.gradle.node.npm.NpmTask

plugins {
    id "cloudflight-gradle-plugin" version "5.5.9"
}

description "EMS Project"
group "io.cloudflight.ems"
version "1.0.0"

cloudflight {
    softwareProjectKey = "ems/ems"
}

subprojects {
    if (isKotlinProject(it)) {
        dependencies {
            implementation platform("io.cloudflight.platform:platform-bom:$cloudflightPlatformVersion")
            annotationProcessor platform("io.cloudflight.platform:platform-bom:$cloudflightPlatformVersion")
            testImplementation platform("io.cloudflight.platform:platform-test-bom:$cloudflightPlatformVersion")
            kapt platform("io.cloudflight.platform:platform-bom:$cloudflightPlatformVersion")
        }
    }

    if (isUiProject(it)) {
        apply plugin: 'java-library'

        tasks.create([name: "npmTest", type: NpmTask]) {
            group = "verification"
            setArgs(["run", "test"])
            dependsOn("npmInstall", "clfNpmLint")
            doFirst {
                environment "GRADLE_BUILD": true
            }
        }

        tasks.check.dependsOn(tasks.npmTest)
    }
}
