<mat-card class="edit-form-wrapper"
          [class.active-card]="formService.dirty$ | async">

    <mat-card-content class="content">
        <ng-content></ng-content>
    </mat-card-content>

    <ng-container *ngIf="formService.dirty$ | async"
                  [ngTemplateOutlet]="saveDiscard">
    </ng-container>
    <ng-container [@slideInOut] *ngIf="formService.success$ | async as success"
                  [ngTemplateOutlet]="saveSuccess"
                  [ngTemplateOutletContext]="{$implicit: success}">
    </ng-container>
    <ng-container [@slideInOut] *ngIf="formService.error$ | async as error"
                  [ngTemplateOutlet]="saveError"
                  [ngTemplateOutletContext]="{$implicit: error}">
    </ng-container>
</mat-card>

<ng-template #saveDiscard>
    <mat-card-footer [@slideInOut] class="footer">
        <button mat-stroked-button class="action-button discard" type="button"
                (click)="formService.setDirty(false); discard.emit()">
            {{'common.cancel.label' | translate}}
        </button>
        <button [disabled]="(formService.valid$ | async) === false"
                mat-raised-button class="action-button" color="primary" type="button"
                (click)="formService.setDirty(false); save.emit()">
            {{formService.saveLabel | translate}}
        </button>
    </mat-card-footer>
</ng-template>

<ng-template #saveSuccess let-message>
    <mat-card-footer [@slideInOut] class="footer">
        <div class="message-wrapper">
            <div class="message alert-success">
                <i class="far fa-check-circle"></i>
                <span *ngIf="message.i18nKey">{{message.i18nKey | translate : message.i18nArguments}}</span>
                <span *ngIf="!message.i18nKey">{{message | translate}}</span>
            </div>
        </div>
    </mat-card-footer>
</ng-template>

<ng-template #saveError let-error>
    <mat-card-footer [@slideInOut] class="footer">
        <div class="message-wrapper">
            <div class="message alert-danger">
                <i class="fas fa-exclamation-triangle"></i>{{error?.i18nKey | translate}}
            </div>
        </div>
        <ng-container *ngTemplateOutlet="saveDiscard"></ng-container>
    </mat-card-footer>
</ng-template>
