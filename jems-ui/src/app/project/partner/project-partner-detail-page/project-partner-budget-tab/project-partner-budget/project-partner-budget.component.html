<ng-container *ngIf="(data$ | async) as data">
    <app-form (save)="updateBudgets()">
        <form appFormLayout [formGroup]="budgetsForm">
            <h3>{{'project.partner.budget.header' | translate}}
                <app-context-info infoPosition="right"
                                  infoText="{{'project.partner.budget.options.office.on.direct.cost.flat.rate.info' | translate}}">
                </app-context-info>
            </h3>

            <ng-container *ngIf="!data.isStaffCostFlatRateActive">
                <h4>{{'project.partner.budget.staff' | translate}}</h4>
                <app-staff-costs-budget-table
                        appNoWidthLimit
                        *ngIf="staff"
                        [availableUnitCosts]="data.unitCosts | filterUnitCosts:  true : BudgetCostCategoryEnum.STAFF_COSTS"
                        [staffCostTable]="data.budgetTables.staffCosts"
                        [editable]="budgetsForm.enabled"
                        [projectPeriods]="data.periods"></app-staff-costs-budget-table>
            </ng-container>
            <ng-container *ngIf="data.isStaffCostFlatRateActive && !data.isOtherFlatRateBasedOnStaffCostActive">
                <h4>{{'project.partner.budget.staff.costs.flat.rate.header' | translate}}</h4>
                <p>{{'project.partner.budget.other.staff.costs.flat.rate.description' | translate}}</p>
                <app-budget-flat-rate-table
                        appNoWidthLimit
                        [total]="data.staffCostsTotal"
                        [description]="'project.partner.budget.staff.costs.flat.rate' | translate"></app-budget-flat-rate-table>
            </ng-container>

            <ng-container *ngIf="!data.isOtherFlatRateBasedOnStaffCostActive">
                <ng-container *ngIf="data.isOfficeOnStaffFlatRateActive || data.isOfficeOnDirectFlatRateActive">
                    <h4>{{'project.partner.budget.office.and.admin.header' | translate}}</h4>
                    <p>
                        {{data.isOfficeOnStaffFlatRateActive ?
                            ('project.partner.budget.office.and.admin.on.staff.description' | translate) :
                            ('project.partner.budget.office.and.admin.on.direct.description' | translate)}}
                    </p>
                    <app-budget-flat-rate-table
                            appNoWidthLimit
                            [total]="data.officeAndAdministrationFlatRateTotal"
                            [description]="'project.partner.budget.office.and.admin.flat.rate' | translate"></app-budget-flat-rate-table>
                </ng-container>
                <ng-container *ngIf="!data.isTravelAndAccommodationFlatRateActive">
                    <h4>{{'project.partner.budget.travel' | translate}}</h4>
                    <app-travel-and-accommodation-costs-budget-table
                            appNoWidthLimit
                            *ngIf="travel"
                            [availableUnitCosts]="data.unitCosts | filterUnitCosts: true : BudgetCostCategoryEnum.TRAVEL_AND_ACCOMMODATION_COSTS "
                            [travelAndAccommodationTable]="data.budgetTables.travelCosts"
                            [editable]="budgetsForm.enabled"
                            [projectPeriods]="data.periods">
                    </app-travel-and-accommodation-costs-budget-table>
                </ng-container>
                <ng-container *ngIf="data.isTravelAndAccommodationFlatRateActive">
                    <h4>{{'project.partner.budget.travel.and.accommodation.flat.rate.header' | translate}}</h4>
                    <p>{{'project.partner.budget.travel.and.accommodation.flat.rate.description' | translate}}</p>
                    <app-budget-flat-rate-table
                            appNoWidthLimit
                            [total]="data.travelAndAccommodationTotal"
                            [description]="'project.partner.budget.travel.and.accommodation.flat.rate.header' | translate"></app-budget-flat-rate-table>
                </ng-container>
                <h4>{{'project.partner.budget.external' | translate}}</h4>
                <app-general-budget-table
                        appNoWidthLimit
                        *ngIf="external"
                        [availableUnitCosts]="data.unitCosts  | filterUnitCosts:  true : BudgetCostCategoryEnum.EXTERNAL_COSTS"
                        [investmentSummaries]="data.investments"
                        [budgetTable]="data.budgetTables.externalCosts"
                        [editable]="budgetsForm.enabled"
                        [tableName]="constants.FORM_CONTROL_NAMES.external"
                        [projectPeriods]="data.periods">
                </app-general-budget-table>
                <h4>{{'project.partner.budget.equipment' | translate}}</h4>
                <app-general-budget-table
                        appNoWidthLimit
                        *ngIf="equipment"
                        [availableUnitCosts]="data.unitCosts  | filterUnitCosts:  true : BudgetCostCategoryEnum.EQUIPMENT_COSTS"
                        [investmentSummaries]="data.investments"
                        [budgetTable]="data.budgetTables.equipmentCosts"
                        [editable]="budgetsForm.enabled"
                        [tableName]="constants.FORM_CONTROL_NAMES.equipment"
                        [projectPeriods]="data.periods">
                </app-general-budget-table>

                <h4>{{'project.partner.budget.infrastructure' | translate}}</h4>
                <app-general-budget-table
                        appNoWidthLimit
                        *ngIf="infrastructure"
                        [investmentSummaries]="data.investments"
                        [availableUnitCosts]="data.unitCosts  | filterUnitCosts:  true : BudgetCostCategoryEnum.INFRASTRUCTURE_COSTS"
                        [budgetTable]="data.budgetTables.infrastructureCosts"
                        [editable]="budgetsForm.enabled"
                        [tableName]="constants.FORM_CONTROL_NAMES.infrastructure"
                        [projectPeriods]="data.periods">
                </app-general-budget-table>
                <ng-container *ngIf="data.unitCosts?.length">
                    <h4>{{'project.partner.budget.unitcosts' | translate}}</h4>
                    <app-unit-costs-budget-table
                            appNoWidthLimit
                            *ngIf="unitCosts"
                            [availableUnitCosts]="data.unitCosts | filterUnitCosts:  false"
                            [unitCostTable]="data.budgetTables.unitCosts"
                            [editable]="budgetsForm.enabled"
                            [projectPeriods]="data.periods">
                    </app-unit-costs-budget-table>
                </ng-container>
            </ng-container>

            <ng-container *ngIf="data.isOtherFlatRateBasedOnStaffCostActive">
                <h4>{{'project.partner.budget.other.costs.flat.rate.header' | translate}}</h4>
                <p>{{'project.partner.budget.other.costs.flat.rate.description' | translate}}</p>
                <app-budget-flat-rate-table
                        appNoWidthLimit
                        [total]="data.otherCostsFlatRateTotal"
                        [description]="'project.partner.budget.other.costs.flat.rate' | translate"></app-budget-flat-rate-table>
            </ng-container>
        </form>
    </app-form>
</ng-container>
