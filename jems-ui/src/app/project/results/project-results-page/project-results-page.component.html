<ng-container *ngIf="data$ | async as data">
    <div>
        <app-breadcrumb></app-breadcrumb>
        <h1>{{'project.application.form.acronym' | translate : {acronym: data.projectAcronym} }}</h1>
        <h2>{{'project.application.form.section.part.c' | translate}}</h2>
    </div>
    <app-form (save)="updateResults()">
        <form appFormLayout [formGroup]="form">
            <h3>{{'project.application.form.section.part.c.subsection.five' | translate}}</h3>
            <p>{{'project.results.intro' | translate}}</p>
            <div appNoWidthLimit *ngFor="let result of results.controls;let i=index">
                <ng-container [formArrayName]="constants.RESULTS.name">
                    <div class="result-container" appFormLayout [formGroupName]="i">
                        <div class="result-header" appNoWidthLimit appMultiColumnRow itemsAlign="space-between">
                            <h4 class="mb-0">{{('project.results.result.title' | translate) + ' ' + (i + 1) }}</h4>
                            <button *ngIf="form.enabled" type="button"
                                    (click)="removeResult(i)" mat-icon-button color="accent">
                                <mat-icon>delete</mat-icon>
                            </button>
                        </div>

                        <mat-form-field [class.mat-form-field-invalid]="!data.resultIndicators.length">
                            <mat-label>{{'project.results.result.indicator' | translate}}</mat-label>
                            <mat-select [disabled]="!data.resultIndicators.length"
                                        [formControlName]="constants.RESULT_INDICATOR.name">
                                <mat-option *ngFor="let resultIndicator of data.resultIndicators"
                                            [value]="resultIndicator.id">
                                    {{resultIndicator.name}}
                                </mat-option>
                            </mat-select>
                            <mat-hint *ngIf="!data.resultIndicators?.length" class="mat-error">
                                {{'project.application.form.overall.objective.specific.objective.required' | translate}}
                            </mat-hint>
                        </mat-form-field>
                        <div appMultiColumnRow stretch>
                            <mat-form-field appFormFieldWidth="large">
                                <mat-label>{{'project.results.result.measurement.unit' | translate}}</mat-label>
                                <input readonly matInput
                                       value="{{getMeasurementUnit(result.get(constants.RESULT_INDICATOR.name)?.value, data.resultIndicators)}}"
                                       [disabled]="form.disabled">
                            </mat-form-field>

                            <mat-form-field appFormFieldWidth="medium">
                                <mat-label>{{'project.results.result.target.value' | translate}}</mat-label>
                                <input currencyMask type="integer" [options]="{min: 1, max: 99999}"
                                       name="targetValue" formControlName="targetValue" matInput>
                            </mat-form-field>

                            <app-project-periods-select
                                    [periods]="data.periods"
                                    [control]="result.get(constants.PERIOD.name)"
                                    label='project.results.result.delivery.period'
                                    (selectionChanged)="formService.setDirty(true)">
                            </app-project-periods-select>
                        </div>

                        <app-multi-language>
                            <app-multi-language-form-field
                                    type="textarea"
                                    label="project.results.result.description"
                                    [formControlName]="constants.DESCRIPTION.name"
                                    [maxLength]="constants.DESCRIPTION.maxLength">
                            </app-multi-language-form-field>
                        </app-multi-language>

                    </div>
                </ng-container>
            </div>
            <button *ngIf="addResultVisible()" mat-stroked-button (click)="addNewResult()">
                + {{'project.results.result.add' | translate}}
            </button>
        </form>
    </app-form>
</ng-container>
