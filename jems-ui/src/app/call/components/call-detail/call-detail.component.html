<app-form (discard)="onCancel()"
          (save)="onSubmit()">
    <form appFormLayout [formGroup]="callForm">
        <h1>{{'call.detail.title' | translate}}</h1>
        <h2>{{'call.general.settings' | translate}}</h2>
        <button *ngIf="call?.id && editable"
                appFormFieldWidth="medium"
                mat-raised-button color="primary"
                [disabled]="publishingRequirementsNotAchieved()"
                (click)="publishCall()">
            {{'call.detail.button.publish' | translate}}
        </button>
        <mat-form-field>
            <mat-label>{{'call.detail.field.name' | translate}}</mat-label>
            <input name="name" formControlName="name" matInput>
            <mat-error>
                <app-form-field-errors
                        [errors]="callForm?.controls?.name?.errors"
                        [messages]="nameErrors">
                </app-form-field-errors>
            </mat-error>
        </mat-form-field>
        <div appMultiColumnRow stretch>
            <mat-form-field>
                <mat-label>{{'call.detail.field.start' | translate}}</mat-label>
                <input required formControlName="startDate" matInput name="startDate"
                       [max]="callForm?.controls?.endDate?.value"
                       [ngxMatDatetimePicker]="start">
                <mat-datepicker-toggle matSuffix [for]="start">
                </mat-datepicker-toggle>
                <ngx-mat-datetime-picker #start></ngx-mat-datetime-picker>
                <mat-error>
                    <app-form-field-errors
                            [errors]="callForm?.controls?.startDate?.errors"
                            [messages]="startDateErrors">
                    </app-form-field-errors>
                </mat-error>
            </mat-form-field>
            <mat-form-field>
                <mat-label>{{'call.detail.field.end' | translate}}</mat-label>
                <input required formControlName="endDate" matInput name="endDate"
                       [min]="callForm?.controls?.startDate?.value"
                       [ngxMatDatetimePicker]="end">
                <mat-datepicker-toggle matSuffix [for]="end">
                </mat-datepicker-toggle>
                <ngx-mat-datetime-picker #end></ngx-mat-datetime-picker>
                <mat-error>
                    <app-form-field-errors
                            [errors]="callForm?.controls?.endDate?.errors"
                            [messages]="endDateErrors">
                    </app-form-field-errors>
                </mat-error>
            </mat-form-field>
        </div>


        <p>{{'call.detail.field.lengthOfPeriod.help' | translate}}</p>
        <mat-form-field>
            <mat-label>{{'call.detail.field.lengthOfPeriod' | translate}}</mat-label>
            <input required type="number" name="lengthOfPeriod" formControlName="lengthOfPeriod" matInput
                   (paste)="tools.checkDigitsOnPaste($event)" (keypress)="tools.checkDigitsOnInput($event)">
            <mat-error>
                <app-form-field-errors
                        [errors]="callForm?.controls?.lengthOfPeriod?.errors"
                        [messages]="lengthOfPeriodErrors">
                </app-form-field-errors>
            </mat-error>
        </mat-form-field>

        <app-expandable-textarea
                [control]="callForm?.controls?.description"
                [errors]="callForm?.controls?.description?.errors"
                [messages]="descriptionErrors"
                [characterLimit]="1000"
                [label]="'call.detail.field.description'"
                [disabled]="!editable">
        </app-expandable-textarea>
        <div>
            <h2>{{'call.programme.priorities.title' | translate}}</h2>
            <app-call-priority-tree
                    *ngIf="priorityCheckboxes"
                    [priorityCheckboxes]="priorityCheckboxes"
                    [disabled]="!editable"
                    [isApplicant]="isApplicant"
                    (selectionChanged)="formChanged()">
            </app-call-priority-tree>
        </div>

        <div>
            <h2>{{'call.strategy.title' | translate}}</h2>
            <app-call-strategies
                    [strategies]="strategies"
                    [disabled]="!editable"
                    [isApplicant]="isApplicant"
                    (selectionChanged)="formChanged()">
            </app-call-strategies>
        </div>

        <div>
            <h2>{{'call.funds.title' | translate}}</h2>
            <div *ngIf="!isApplicant">
                <mat-checkbox
                        name="multipleFundsAllowed"
                        formControlName="multipleFundsAllowed"
                        (click)="$event.stopPropagation()"
                        [disabled]="!editable"
                        [checked]="callForm?.controls?.multipleFundsAllowed.value">
                    {{'call.multiple.funds.allowed' | translate}}
                </mat-checkbox>
            </div>
        </div>

        <div>
            <h2>{{'call.funds.select.funds' | translate}}</h2>
            <app-call-funds
                    [funds]="funds"
                    [disabled]="!editable"
                    [isApplicant]="isApplicant"
                    (selectionChanged)="formChanged()">
            </app-call-funds>
        </div>
    </form>
</app-form>
