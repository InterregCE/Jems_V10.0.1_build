<app-form (discard)="onCancel()"
          (save)="onSubmit()">
    <form id="call-form" [formGroup]="callForm">
        <h2 id="callTitle">{{'call.detail.title' | translate}}</h2>

        <div>
            <h4>{{'call.general.settings' | translate}}</h4>
            <button *ngIf="call?.id && editable"
                    mat-raised-button color="primary"
                    id="publish-btn"
                    class="mb-3 mt-2"
                    [disabled]="publishingRequirementsNotAchieved()"
                    (click)="publishCall()">
                {{'call.detail.button.publish' | translate}}
            </button>
            <mat-form-field class="pb-3">
                <mat-label>{{'call.detail.field.name' | translate}}</mat-label>
                <input name="name" formControlName="name" matInput
                       placeholder="{{'call.detail.field.name' | translate}}">
                <mat-error>
                    <app-form-field-errors
                            [errors]="callForm?.controls?.name?.errors"
                            [messages]="nameErrors">
                    </app-form-field-errors>
                </mat-error>
            </mat-form-field>
            <div id="datepicker-container" class="pb-3">
                <mat-form-field>
                    <mat-label>{{'call.detail.field.start' | translate}}</mat-label>
                    <input required formControlName="startDate" matInput name="startDate"
                           [max]="callForm?.controls?.endDate?.value"
                           [ngxMatDatetimePicker]="start">
                    <mat-datepicker-toggle matSuffix [for]="start">
                    </mat-datepicker-toggle>
                    <ngx-mat-datetime-picker #start></ngx-mat-datetime-picker>
                    <mat-error>
                        <app-form-field-errors
                                [errors]="callForm?.controls?.startDate?.errors"
                                [messages]="startDateErrors">
                        </app-form-field-errors>
                    </mat-error>
                </mat-form-field>
                <mat-form-field class="pl-3">
                    <mat-label>{{'call.detail.field.end' | translate}}</mat-label>
                    <input required formControlName="endDate" matInput name="endDate"
                           [min]="callForm?.controls?.startDate?.value"
                           [ngxMatDatetimePicker]="end">
                    <mat-datepicker-toggle matSuffix [for]="end">
                    </mat-datepicker-toggle>
                    <ngx-mat-datetime-picker #end></ngx-mat-datetime-picker>
                    <mat-error>
                        <app-form-field-errors
                                [errors]="callForm?.controls?.endDate?.errors"
                                [messages]="endDateErrors">
                        </app-form-field-errors>
                    </mat-error>
                </mat-form-field>
            </div>

            <p>{{'call.detail.field.lengthOfPeriod.help' | translate}}</p>
            <mat-form-field class="pb-3">
                <mat-label>{{'call.detail.field.lengthOfPeriod' | translate}}</mat-label>
                <input required type="number" name="lengthOfPeriod" formControlName="lengthOfPeriod" matInput
                       placeholder="{{'call.detail.field.lengthOfPeriod' | translate}}"
                       (paste)="tools.checkDigitsOnPaste($event)" (keypress)="tools.checkDigitsOnInput($event)">
                <mat-error>
                    <app-form-field-errors
                            [errors]="callForm?.controls?.lengthOfPeriod?.errors"
                            [messages]="lengthOfPeriodErrors">
                    </app-form-field-errors>
                </mat-error>
            </mat-form-field>

            <app-expandable-textarea
                    class="pb-3"
                    [control]="callForm?.controls?.description"
                    [errors]="callForm?.controls?.description?.errors"
                    [messages]="descriptionErrors"
                    [characterLimit]="1000"
                    [label]="'call.detail.field.description'"
                    [disabled]="!editable">
            </app-expandable-textarea>
        </div>

        <div>
            <h4 id="callPriorities">{{'call.programme.priorities.title' | translate}}</h4>
            <app-call-priority-tree
                    *ngIf="priorityCheckboxes"
                    [priorityCheckboxes]="priorityCheckboxes"
                    [disabled]="!editable"
                    [isApplicant]="isApplicant"
                    (selectionChanged)="formChanged()">
            </app-call-priority-tree>
        </div>

        <div>
            <h4 id="callStrategies">{{'call.strategy.title' | translate}}</h4>
            <app-call-strategies
                    [strategies]="strategies"
                    [disabled]="!editable"
                    [isApplicant]="isApplicant"
                    (selectionChanged)="formChanged()">
            </app-call-strategies>
        </div>

        <div>
            <h4 id="callFunds">{{'call.funds.title' | translate}}</h4>
            <app-call-funds
                    [funds]="funds"
                    [disabled]="!editable"
                    [isApplicant]="isApplicant"
                    (selectionChanged)="formChanged()">
            </app-call-funds>
        </div>
    </form>
</app-form>
