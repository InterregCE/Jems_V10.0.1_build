<app-main-page-template [needsCard]="true"
                        subTitleKey="users.table.title.label"
                        titleKey="topbar.main.user.user.management">
    <button *hasPermission="PermissionsEnum.UserCreate"
            class="mb-3"
            color="primary"
            mat-raised-button
            routerLink="/app/system/user/detail/create">
        <mat-icon>add</mat-icon>
        {{'user.create.button.add' | translate}}
    </button>
    <app-alert *ngIf="success"
               [show]="true"
               [type]="Alert.SUCCESS">
        <p *ngIf="success.i18nKey">{{success.i18nKey | translate : success.i18nArguments}}</p>
    </app-alert>

    <app-filter-template *ngIf="data$ | async as data"
                         [formGroup]="filterForm"
                         [isThereAnyActiveFilter]="isThereAnyActiveFilter()">
        <div alignItems="start" appMultiColumnRow>
            <app-filter-text-input
                    formControlName="name"
                    label="user.detail.field.name">
            </app-filter-text-input>

            <app-filter-text-input
                    formControlName="surname"
                    label="user.detail.field.surname">
            </app-filter-text-input>

            <app-filter-text-input
                    formControlName="email"
                    label="user.detail.field.email">
            </app-filter-text-input>

            <app-filter-autocomplete-input
                    [options]="data.roles"
                    formControlName="roles"
                    label="user.detail.field.role"
                    placeholder="user.detail.search.for.roles">
            </app-filter-autocomplete-input>

            <app-filter-autocomplete-input
                    [filterable]="false"
                    [options]="data.userStatuses"
                    formControlName="userStatuses"
                    label="user.detail.field.status"
                    placeholder="user.detail.search.for.status">
            </app-filter-autocomplete-input>
        </div>
    </app-filter-template>

    <div *ngIf="userPageStore.page$ | async as page">
        <app-table
                (newPageIndex)="userPageStore.newPageIndex$.next($event)"
                (newPageSize)="userPageStore.newPageSize$.next($event)"
                (sortRows)="userPageStore.newSort$.next($event)"
                [configuration]="tableConfiguration"
                [pageIndex]="userPageStore.newPageIndex$ | async"
                [rows]="page.content"
                [totalElements]="page.totalElements">
        </app-table>
    </div>
</app-main-page-template>
